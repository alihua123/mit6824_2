<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>checkSingle DFS æœç´¢æ ‘çŠ¶å›¾</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .tree-container {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            overflow-x: auto;
        }
        .tree {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 1200px;
        }
        .level {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            width: 100%;
        }
        .node {
            background: #3498db;
            color: white;
            padding: 15px 20px;
            margin: 0 15px;
            border-radius: 8px;
            text-align: center;
            position: relative;
            min-width: 150px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .node.success {
            background: #27ae60;
        }
        .node.failure {
            background: #e74c3c;
        }
        .node.backtrack {
            background: #f39c12;
        }
        .node.final {
            background: #8e44ad;
        }
        .connection {
            width: 2px;
            height: 30px;
            background: #34495e;
            margin: 0 auto;
        }
        .branch-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin: 20px 0;
        }
        .branch {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 30px;
        }
        .branch-line {
            width: 2px;
            height: 40px;
            background: #34495e;
        }
        .horizontal-line {
            height: 2px;
            background: #34495e;
            margin: 20px 0;
        }
        .state-info {
            background: #ecf0f1;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 12px;
            color: #2c3e50;
        }
        .legend {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 15px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
        }
        .scenario {
            margin: 40px 0;
            padding: 20px;
            border: 2px solid #3498db;
            border-radius: 8px;
        }
        .code-snippet {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        .highlight {
            background: #f1c40f;
            color: #2c3e50;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ³ checkSingle DFS æœç´¢æ ‘çŠ¶å›¾</h1>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #3498db;"></div>
                <span>åˆå§‹/ä¸­é—´èŠ‚ç‚¹</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #27ae60;"></div>
                <span>æ“ä½œæˆåŠŸ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span>æ“ä½œå¤±è´¥</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f39c12;"></div>
                <span>å›æº¯èŠ‚ç‚¹</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #8e44ad;"></div>
                <span>æœ€ç»ˆç»“æœ</span>
            </div>
        </div>

        <div class="scenario">
            <h2>ğŸ“‹ ç¤ºä¾‹åœºæ™¯ï¼šPut("x","1") å’Œ Get("x") æ—¶é—´é‡å </h2>
            <p><strong>æ“ä½œå†å²ï¼š</strong></p>
            <div class="code-snippet">
Put("x","1"): è°ƒç”¨t=10 â”€â”€â”€â”€â”€â”€ è¿”å›t=30
Get("x"):          è°ƒç”¨t=20 â”€â”€ è¿”å›t=40
            </div>
            <p><strong>é“¾è¡¨ç»“æ„ï¼š</strong> [Call Put] â†” [Call Get] â†” [Ret Put] â†” [Ret Get]</p>
        </div>

        <div class="tree-container">
            <h3>ğŸ” DFS æœç´¢æ ‘</h3>
            <div class="tree">
                <!-- æ ¹èŠ‚ç‚¹ -->
                <div class="level">
                    <div class="node">
                        å¼€å§‹ checkSingle<br>
                        <div class="state-info">
                            state = ""<br>
                            linearized = {}<br>
                            entry = Call Put
                        </div>
                    </div>
                </div>
                
                <div class="connection"></div>
                
                <!-- ç¬¬ä¸€å±‚ï¼šå°è¯•Putæ“ä½œ -->
                <div class="level">
                    <div class="node">
                        å°è¯• Put("x","1")<br>
                        <div class="state-info">
                            model.Step(state="", Put, OK)
                        </div>
                    </div>
                </div>
                
                <div class="branch-container">
                    <div class="branch">
                        <div class="branch-line"></div>
                        <div class="node success">
                            Put æ“ä½œæˆåŠŸ<br>
                            <div class="state-info">
                                ok = true<br>
                                newState = "x:1"<br>
                                ç»§ç»­ DFS
                            </div>
                        </div>
                        <div class="branch-line"></div>
                        
                        <!-- PutæˆåŠŸåå°è¯•Get -->
                        <div class="node">
                            å°è¯• Get("x")<br>
                            <div class="state-info">
                                state = "x:1"<br>
                                entry = Call Get
                            </div>
                        </div>
                        
                        <div class="branch-container">
                            <div class="branch">
                                <div class="branch-line"></div>
                                <div class="node success">
                                    Get è¿”å› "1"<br>
                                    <div class="state-info">
                                        model.Step("x:1", Get, "1")<br>
                                        ok = true âœ…
                                    </div>
                                </div>
                                <div class="branch-line"></div>
                                <div class="node final">
                                    æˆåŠŸï¼<br>
                                    çº¿æ€§åŒ–åºåˆ—: [Put, Get]
                                </div>
                            </div>
                            
                            <div class="branch">
                                <div class="branch-line"></div>
                                <div class="node failure">
                                    Get è¿”å› "2"<br>
                                    <div class="state-info">
                                        model.Step("x:1", Get, "2")<br>
                                        ok = false âŒ
                                    </div>
                                </div>
                                <div class="branch-line"></div>
                                <div class="node backtrack">
                                    è·³è¿‡ï¼Œå°è¯•ä¸‹ä¸€ä¸ª<br>
                                    entry = entry.next
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="branch">
                        <div class="branch-line"></div>
                        <div class="node failure">
                            Put æ“ä½œå¤±è´¥<br>
                            <div class="state-info">
                                ok = false<br>
                                è·³è¿‡ Put æ“ä½œ
                            </div>
                        </div>
                        <div class="branch-line"></div>
                        
                        <!-- Putå¤±è´¥åå°è¯•Get -->
                        <div class="node">
                            å°è¯• Get("x")<br>
                            <div class="state-info">
                                state = ""<br>
                                entry = Call Get
                            </div>
                        </div>
                        
                        <div class="branch-line"></div>
                        
                        <div class="node success">
                            Get è¿”å› ""<br>
                            <div class="state-info">
                                model.Step("", Get, "")<br>
                                ok = true âœ…
                            </div>
                        </div>
                        
                        <div class="branch-line"></div>
                        
                        <!-- GetæˆåŠŸåå›åˆ°Put -->
                        <div class="node">
                            å›åˆ° Put("x","1")<br>
                            <div class="state-info">
                                state = ""<br>
                                å°è¯•å‰©ä½™æ“ä½œ
                            </div>
                        </div>
                        
                        <div class="branch-line"></div>
                        
                        <div class="node final">
                            æˆåŠŸï¼<br>
                            çº¿æ€§åŒ–åºåˆ—: [Get, Put]
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="scenario">
            <h2>ğŸ”„ å›æº¯æœºåˆ¶è¯¦è§£</h2>
            <div class="code-snippet">
<span class="highlight">// å½“å‰è·¯å¾„å¤±è´¥æ—¶çš„å›æº¯é€»è¾‘</span>
if len(calls) == 0 {
    return false, longest  // æ— æ³•å›æº¯ï¼Œå½»åº•å¤±è´¥
}

// å›æº¯åˆ°ä¸Šä¸€ä¸ªé€‰æ‹©ç‚¹
callsTop := calls[len(calls)-1]
entry = callsTop.entry      // æ¢å¤åˆ°ä¹‹å‰çš„æ“ä½œ
state = callsTop.state      // æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€
linearized.clear(uint(entry.id))  // æ¸…é™¤çº¿æ€§åŒ–æ ‡è®°
calls = calls[:len(calls)-1]      // å¼¹å‡ºè°ƒç”¨æ ˆ
unlift(entry)               // å°†æ“ä½œé‡æ–°åŠ å…¥é“¾è¡¨
<span class="highlight">entry = entry.next          // ğŸ”‘ å°è¯•ä¸‹ä¸€ä¸ªå¯èƒ½çš„æ“ä½œ</span>
            </div>
        </div>

        <div class="scenario">
            <h2>ğŸ¯ å…³é”®ä»£ç è·¯å¾„</h2>
            
            <h3>1. æ“ä½œæˆåŠŸè·¯å¾„</h3>
            <div class="code-snippet">
if ok {
    // æ“ä½œåˆæ³•ï¼ŒåŠ å…¥çº¿æ€§åŒ–åºåˆ—
    newLinearized := linearized.clone().set(uint(entry.id))
    if !cacheContains(model, cache, newCacheEntry) {
        calls = append(calls, callsEntry{entry, state})
        state = newState
        linearized.set(uint(entry.id))
        <span class="highlight">lift(entry)                    // ä»é“¾è¡¨ç§»é™¤</span>
        <span class="highlight">entry = headEntry.next         // ç»§ç»­ä¸‹ä¸€ä¸ªæ“ä½œ</span>
    }
}
            </div>

            <h3>2. æ“ä½œå¤±è´¥è·¯å¾„</h3>
            <div class="code-snippet">
} else {
    // æ“ä½œä¸åˆæ³•ï¼Œè·³è¿‡è¯¥æ“ä½œ
    <span class="highlight">entry = entry.next  // ğŸ”‘ å°è¯•é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªæ“ä½œ</span>
}
            </div>

            <h3>3. å›æº¯è·¯å¾„</h3>
            <div class="code-snippet">
} else {
    // éœ€è¦å›æº¯
    callsTop := calls[len(calls)-1]
    entry = callsTop.entry
    state = callsTop.state
    linearized.clear(uint(entry.id))
    calls = calls[:len(calls)-1]
    <span class="highlight">unlift(entry)               // é‡æ–°åŠ å…¥é“¾è¡¨</span>
    <span class="highlight">entry = entry.next          // å°è¯•å…¶ä»–æ“ä½œ</span>
}
            </div>
        </div>

        <div class="scenario">
            <h2>ğŸ§  æœç´¢ç­–ç•¥æ€»ç»“</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h4>ğŸ” æ·±åº¦ä¼˜å…ˆæœç´¢ (DFS)</h4>
                    <ul>
                        <li>é€‰æ‹©ä¸€ä¸ªæ“ä½œåï¼Œç«‹å³é€’å½’å¤„ç†å‰©ä½™æ“ä½œ</li>
                        <li>ç›´åˆ°æ‰¾åˆ°å®Œæ•´è§£æˆ–é‡åˆ°æ­»è·¯</li>
                        <li>ä½¿ç”¨è°ƒç”¨æ ˆ <code>calls</code> è®°å½•è·¯å¾„</li>
                    </ul>
                </div>
                <div>
                    <h4>ğŸ”„ å›æº¯æœç´¢</h4>
                    <ul>
                        <li>å½“å‰è·¯å¾„å¤±è´¥æ—¶ï¼Œå›åˆ°ä¸Šä¸€ä¸ªé€‰æ‹©ç‚¹</li>
                        <li>å°è¯•å…¶ä»–å¯èƒ½çš„æ“ä½œ</li>
                        <li>ç³»ç»Ÿæ€§åœ°æ¢ç´¢æ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œé¡ºåº</li>
                    </ul>
                </div>
            </div>
            
            <h4>ğŸ¯ æ ¸å¿ƒæ€æƒ³</h4>
            <p>é€šè¿‡ <strong>DFS + å›æº¯</strong> çš„ç»„åˆï¼Œ<code>checkSingle</code> èƒ½å¤Ÿï¼š</p>
            <ol>
                <li><strong>ç³»ç»Ÿæ€§æ¢ç´¢</strong>ï¼šå°è¯•æ‰€æœ‰å¯èƒ½çš„æ“ä½œæ‰§è¡Œé¡ºåº</li>
                <li><strong>æ—©æœŸå‰ªæ</strong>ï¼šä¸€æ—¦æ‰¾åˆ°åˆæ³•åºåˆ—å°±è¿”å›æˆåŠŸ</li>
                <li><strong>å®Œæ•´æ€§ä¿è¯</strong>ï¼šåªæœ‰ç©·å°½æ‰€æœ‰å¯èƒ½åæ‰è¿”å›å¤±è´¥</li>
                <li><strong>æ•ˆç‡ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ç¼“å­˜é¿å…é‡å¤è®¡ç®—ç›¸åŒçŠ¶æ€</li>
            </ol>
        </div>
    </div>
</body>
</html>