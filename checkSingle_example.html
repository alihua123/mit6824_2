<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>checkSingle æ–¹æ³•å·¥ä½œæµç¨‹å¯è§†åŒ–</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .step {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #e74c3c;
            border-radius: 8px;
            background-color: #fdf2f2;
        }
        .step h3 {
            color: #e74c3c;
            margin-top: 0;
        }
        .data-flow {
            display: flex;
            align-items: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .data-box {
            background: #3498db;
            color: white;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 120px;
            text-align: center;
        }
        .arrow {
            font-size: 20px;
            color: #e74c3c;
            margin: 0 10px;
        }
        .state-box {
            background: #27ae60;
            color: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .operation-box {
            background: #f39c12;
            color: white;
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
            display: inline-block;
        }
        .linked-list {
            display: flex;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .node {
            background: #9b59b6;
            color: white;
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
            position: relative;
        }
        .node::after {
            content: "â†”";
            position: absolute;
            right: -15px;
            color: #2c3e50;
            font-weight: bold;
        }
        .node:last-child::after {
            content: "";
        }
        .cache-table {
            border-collapse: collapse;
            width: 100%;
            margin: 15px 0;
        }
        .cache-table th, .cache-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .cache-table th {
            background-color: #34495e;
            color: white;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .failure {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .timeline {
            position: relative;
            margin: 20px 0;
        }
        .timeline-item {
            background: #ecf0f1;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
            position: relative;
        }
        .timeline-item::before {
            content: attr(data-time);
            position: absolute;
            left: -80px;
            top: 15px;
            background: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” checkSingle æ–¹æ³•å·¥ä½œæµç¨‹å¯è§†åŒ–</h1>
        
        <h2>ğŸ“‹ ç¤ºä¾‹åœºæ™¯</h2>
        <p><strong>é”®å€¼å­˜å‚¨æ“ä½œå†å²ï¼š</strong></p>
        <div class="timeline">
            <div class="timeline-item" data-time="t=10">
                <strong>å®¢æˆ·ç«¯Aè°ƒç”¨:</strong> Put("x", "1")
            </div>
            <div class="timeline-item" data-time="t=20">
                <strong>å®¢æˆ·ç«¯Bè°ƒç”¨:</strong> Get("x")
            </div>
            <div class="timeline-item" data-time="t=30">
                <strong>å®¢æˆ·ç«¯Aè¿”å›:</strong> Put("x", "1") â†’ OK
            </div>
            <div class="timeline-item" data-time="t=40">
                <strong>å®¢æˆ·ç«¯Bè¿”å›:</strong> Get("x") â†’ "1"
            </div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤1: åˆå§‹åŒ–æ•°æ®ç»“æ„</h3>
            <div class="state-box">
                <strong>åˆå§‹çŠ¶æ€:</strong><br>
                â€¢ state = "" (ç©ºçš„KVå­˜å‚¨)<br>
                â€¢ linearized = {} (ç©ºçš„å·²çº¿æ€§åŒ–æ“ä½œé›†åˆ)<br>
                â€¢ cache = {} (ç©ºçš„çŠ¶æ€ç¼“å­˜)<br>
                â€¢ calls = [] (ç©ºçš„è°ƒç”¨æ ˆ)
            </div>
            
            <p><strong>æ¡ç›®è½¬æ¢:</strong></p>
            <div class="data-flow">
                <div class="data-box">æ“ä½œå†å²</div>
                <div class="arrow">â†’</div>
                <div class="data-box">æ¡ç›®åˆ—è¡¨</div>
            </div>
            
            <div class="linked-list">
                <div class="node">Call Put<br>t=10, id=0</div>
                <div class="node">Call Get<br>t=20, id=1</div>
                <div class="node">Ret Put<br>t=30, id=0</div>
                <div class="node">Ret Get<br>t=40, id=1</div>
            </div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤2: ç¬¬ä¸€æ¬¡DFSè¿­ä»£ - å¤„ç†Putæ“ä½œ</h3>
            
            <div class="data-flow">
                <div class="data-box">å½“å‰æ¡ç›®<br>Call Put</div>
                <div class="arrow">â†’</div>
                <div class="data-box">æ£€æŸ¥åŒ¹é…<br>æœ‰Ret Put</div>
                <div class="arrow">â†’</div>
                <div class="data-box">è°ƒç”¨æ¨¡å‹<br>Step()</div>
            </div>

            <div class="state-box">
                <strong>æ¨¡å‹è°ƒç”¨:</strong><br>
                model.Step(state="", input=Put("x","1"), output=OK)<br>
                <strong>è¿”å›:</strong> ok=true, newState="x:1"
            </div>

            <div class="data-flow">
                <div class="data-box success">æ“ä½œåˆæ³•!</div>
                <div class="arrow">â†’</div>
                <div class="data-box">æ›´æ–°çŠ¶æ€</div>
                <div class="arrow">â†’</div>
                <div class="data-box">ç»§ç»­DFS</div>
            </div>

            <div class="state-box">
                <strong>æ›´æ–°åçŠ¶æ€:</strong><br>
                â€¢ state = "x:1" (é”®xçš„å€¼ä¸º1)<br>
                â€¢ linearized = {0} (æ“ä½œ0å·²çº¿æ€§åŒ–)<br>
                â€¢ calls = [{entry: Call Put, prevState: ""}] (ä¿å­˜å›æº¯ä¿¡æ¯)<br>
                â€¢ é“¾è¡¨: Putæ“ä½œè¢«ç§»é™¤(lift)
            </div>

            <div class="linked-list">
                <div class="node" style="background: #95a5a6;">Call Put<br>(å·²ç§»é™¤)</div>
                <div class="node">Call Get<br>t=20, id=1</div>
                <div class="node" style="background: #95a5a6;">Ret Put<br>(å·²ç§»é™¤)</div>
                <div class="node">Ret Get<br>t=40, id=1</div>
            </div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤3: ç¬¬äºŒæ¬¡DFSè¿­ä»£ - å¤„ç†Getæ“ä½œ</h3>
            
            <div class="data-flow">
                <div class="data-box">å½“å‰æ¡ç›®<br>Call Get</div>
                <div class="arrow">â†’</div>
                <div class="data-box">æ£€æŸ¥åŒ¹é…<br>æœ‰Ret Get</div>
                <div class="arrow">â†’</div>
                <div class="data-box">è°ƒç”¨æ¨¡å‹<br>Step()</div>
            </div>

            <div class="state-box">
                <strong>æ¨¡å‹è°ƒç”¨:</strong><br>
                model.Step(state="x:1", input=Get("x"), output="1")<br>
                <strong>è¿”å›:</strong> ok=true, newState="x:1" (çŠ¶æ€ä¸å˜)
            </div>

            <div class="data-flow">
                <div class="data-box success">æ“ä½œåˆæ³•!</div>
                <div class="arrow">â†’</div>
                <div class="data-box">æ›´æ–°çŠ¶æ€</div>
                <div class="arrow">â†’</div>
                <div class="data-box">é“¾è¡¨ä¸ºç©º</div>
            </div>

            <div class="state-box">
                <strong>æœ€ç»ˆçŠ¶æ€:</strong><br>
                â€¢ state = "x:1"<br>
                â€¢ linearized = {0, 1} (æ‰€æœ‰æ“ä½œéƒ½å·²çº¿æ€§åŒ–)<br>
                â€¢ calls = [{entry: Call Put, prevState: ""}, {entry: Call Get, prevState: "x:1"}]<br>
                â€¢ é“¾è¡¨: ç©º (æ‰€æœ‰æ“ä½œéƒ½å·²å¤„ç†)
            </div>

            <div class="linked-list">
                <div class="node" style="background: #95a5a6;">Call Put<br>(å·²ç§»é™¤)</div>
                <div class="node" style="background: #95a5a6;">Call Get<br>(å·²ç§»é™¤)</div>
                <div class="node" style="background: #95a5a6;">Ret Put<br>(å·²ç§»é™¤)</div>
                <div class="node" style="background: #95a5a6;">Ret Get<br>(å·²ç§»é™¤)</div>
            </div>
        </div>

        <div class="step success">
            <h3>æ­¥éª¤4: æˆåŠŸç»“æŸ</h3>
            <div class="state-box">
                <strong>ç»“æœ:</strong><br>
                â€¢ è¿”å›: (true, çº¿æ€§åŒ–åºåˆ—[0, 1])<br>
                â€¢ æ‰€æœ‰æ“ä½œéƒ½æ‰¾åˆ°äº†æœ‰æ•ˆçš„çº¿æ€§åŒ–é¡ºåº<br>
                â€¢ ç³»ç»Ÿæ»¡è¶³çº¿æ€§ä¸€è‡´æ€§
            </div>
        </div>

        <h2>ğŸ”„ æ•°æ®æµæ€»ç»“</h2>
        <div class="data-flow">
            <div class="data-box">æ“ä½œå†å²</div>
            <div class="arrow">â†’</div>
            <div class="data-box">æ¡ç›®é“¾è¡¨</div>
            <div class="arrow">â†’</div>
            <div class="data-box">DFSæœç´¢</div>
            <div class="arrow">â†’</div>
            <div class="data-box">æ¨¡å‹éªŒè¯</div>
            <div class="arrow">â†’</div>
            <div class="data-box">çº¿æ€§åŒ–ç»“æœ</div>
        </div>

        <h2>âŒ å¤±è´¥åœºæ™¯ç¤ºä¾‹</h2>
        <div class="step failure">
            <h3>å¦‚æœGetè¿”å›é”™è¯¯å€¼"2"ä¼šæ€æ ·ï¼Ÿ</h3>
            <div class="state-box" style="background: #e74c3c;">
                <strong>æ¨¡å‹è°ƒç”¨:</strong><br>
                model.Step(state="x:1", input=Get("x"), output="2")<br>
                <strong>è¿”å›:</strong> ok=false (æœŸæœ›è¿”å›"1"ï¼Œå®é™…è¿”å›"2")
            </div>
            
            <div class="data-flow">
                <div class="data-box failure">æ“ä½œä¸åˆæ³•!</div>
                <div class="arrow">â†’</div>
                <div class="data-box">è·³è¿‡æ“ä½œ</div>
                <div class="arrow">â†’</div>
                <div class="data-box">å°è¯•å…¶ä»–è·¯å¾„</div>
                <div class="arrow">â†’</div>
                <div class="data-box">å›æº¯æˆ–å¤±è´¥</div>
            </div>
        </div>

        <h2>ğŸ§  å…³é”®æ¦‚å¿µ</h2>
        <table class="cache-table">
            <tr>
                <th>æ¦‚å¿µ</th>
                <th>ä½œç”¨</th>
                <th>ç¤ºä¾‹</th>
            </tr>
            <tr>
                <td><strong>çŠ¶æ€è½¬æ¢</strong></td>
                <td>éªŒè¯æ“ä½œçš„è¯­ä¹‰æ­£ç¡®æ€§</td>
                <td>Put("x","1") å°†çŠ¶æ€ä» "" è½¬æ¢ä¸º "x:1"</td>
            </tr>
            <tr>
                <td><strong>æ·±åº¦ä¼˜å…ˆæœç´¢</strong></td>
                <td>å°è¯•æ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œé¡ºåº</td>
                <td>å…ˆå°è¯•Putå†Getï¼Œå¦‚æœå¤±è´¥åˆ™å°è¯•å…¶ä»–é¡ºåº</td>
            </tr>
            <tr>
                <td><strong>å›æº¯æœºåˆ¶</strong></td>
                <td>å½“è·¯å¾„å¤±è´¥æ—¶æ¢å¤ä¹‹å‰çŠ¶æ€</td>
                <td>ä½¿ç”¨callsæ ˆä¿å­˜å’Œæ¢å¤çŠ¶æ€</td>
            </tr>
            <tr>
                <td><strong>ç¼“å­˜ä¼˜åŒ–</strong></td>
                <td>é¿å…é‡å¤è®¡ç®—ç›¸åŒçŠ¶æ€</td>
                <td>cache[state+linearized] = result</td>
            </tr>
        </table>

        <div class="step">
            <h3>ğŸ¯ ç®—æ³•æ ¸å¿ƒæ€æƒ³</h3>
            <p>checkSingleæ–¹æ³•é€šè¿‡<strong>æ·±åº¦ä¼˜å…ˆæœç´¢</strong>å°è¯•æ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„æ“ä½œæ‰§è¡Œé¡ºåºï¼Œä½¿å¾—ï¼š</p>
            <ol>
                <li><strong>è¯­ä¹‰æ­£ç¡®æ€§</strong>ï¼šæ¯ä¸ªæ“ä½œçš„è¾“å…¥è¾“å‡ºç¬¦åˆæ¨¡å‹å®šä¹‰</li>
                <li><strong>æ—¶é—´çº¦æŸ</strong>ï¼šæ“ä½œçš„æ‰§è¡Œæ—¶é—´åœ¨å…¶è°ƒç”¨å’Œè¿”å›æ—¶é—´ä¹‹é—´</li>
                <li><strong>å®Œæ•´æ€§</strong>ï¼šæ‰€æœ‰æ“ä½œéƒ½èƒ½è¢«æˆåŠŸçº¿æ€§åŒ–</li>
            </ol>
            <p>å¦‚æœæ‰¾åˆ°è¿™æ ·çš„é¡ºåºï¼Œè¯´æ˜ç³»ç»Ÿæ»¡è¶³<strong>çº¿æ€§ä¸€è‡´æ€§</strong>ï¼›å¦åˆ™è¯´æ˜å­˜åœ¨ä¸€è‡´æ€§è¿è§„ã€‚</p>
        </div>
    </div>
</body>
</html>